@{
    var productData = ViewBag.ProductData as JObject; // Datos del producto obtenidos de la API
    var errorMessage = ViewBag.ErrorMessage as string; // Mensaje de error, si existe
    var productName = ViewBag.ProductName as string; // Nombre del producto
}

<h1 class="product-title">@productName</h1>

@if (!string.IsNullOrEmpty(errorMessage))
{
    <div class="error-message">
        <p>@errorMessage</p>
    </div>
}
else if (productData != null && productData.HasValues)
{
    <div class="product-section">
        <div class="product-inner">
            <div class="product-details-container">
                <div class="product-image-rating">
                    <div class="product-image-wrapper">
                        @if (!string.IsNullOrEmpty(productData["image_url"]?.ToString()))
                        {
                            <img src="@productData["image_url"].ToString()" 
                                 alt="@productName"
                                 class="product-image-new" />
                        }
                        else
                        {
                            <img src="/img/lays-classic.svg" 
                                 alt="Imagen no disponible"
                                 class="product-image-new" />
                        }
                        <div class="product-rating">
                            <span class="rating-circle rating-red"></span>
                            <h3 class="rating-text">
                                Calidad: @(productData["nutrition_grades_tags"]?.FirstOrDefault()?.ToString()?.ToUpper() ?? "Sin calificación")
                            </h3>
                        </div>
                    </div>
                </div>
                <div class="product-nutrition-info">
                    <div class="nutrition-info-item">
                        <img src="/img/icon_protein.svg" alt="Proteínas" class="nutrition-icon" />
                        <span>Proteínas: @(productData["nutriments"]?["proteins_100g"] ?? "No disponible") g</span>
                    </div>
                    <div class="nutrition-info-item">
                        <img src="/img/icon_scales.svg" alt="Carbohidratos" class="nutrition-icon" />
                        <span>Carbohidratos: @(productData["nutriments"]?["carbohydrates_100g"] ?? "No disponible") g</span>
                    </div>
                    <div class="nutrition-info-item">
                        <img src="/img/icon_tick.svg" alt="Grasas" class="nutrition-icon" />
                        <span>Grasas: @(productData["nutriments"]?["fat_100g"] ?? "No disponible") g</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    @* Nutrition Evaluation Section *@
    <div class="nutrition-evaluation">
        <h2>Evaluación Nutricional</h2>

        <h3>Aspectos Positivos</h3>
        @if (productData["nutrient_levels"]?["fat"]?.ToString() == "low")
        {
            <div class="nutrition-item positive">
                <img src="/img/icon_fat.svg" class="nutrition-icon" />
                <div class="nutrition-description">
                    <h4>Bajo en Grasas</h4>
                    <p>Ideal si sigues una dieta reducida en grasas.</p>
                </div>
                <span>@(productData["nutriments"]?["fat_100g"] ?? "No disponible") g cada 100 g</span>
                <img src="/img/icon_tick.svg" class="tick-icon" />
            </div>
        }

        @if (productData["nutrient_levels"]?["salt"]?.ToString() == "low")
        {
            <div class="nutrition-item positive">
                <img src="/img/icon_salt.svg" class="nutrition-icon" />
                <div class="nutrition-description">
                    <h4>Bajo en Sodio</h4>
                    <p>Contribuye a mantener una ingesta controlada de sodio.</p>
                </div>
                <span>@(productData["nutriments"]?["salt_100g"] ?? "No disponible") g cada 100 g</span>
                <img src="/img/icon_tick.svg" class="tick-icon" />
            </div>
        }

        @if (productData["nutrient_levels"]?["fiber"]?.ToString() == "high")
        {
            <div class="nutrition-item positive">
                <img src="/img/icon_fiber.svg" class="nutrition-icon" />
                <div class="nutrition-description">
                    <h4>Alto en Fibra</h4>
                    <p>Contribuye a una mejor digestión y control del colesterol.</p>
                </div>
                <span>@(productData["nutriments"]?["fiber_100g"] ?? "No disponible") g cada 100 g</span>
                <img src="/img/icon_tick.svg" class="tick-icon" />
            </div>
        }

        <h3>Aspectos Negativos</h3>
        @if (productData["nutrient_levels"]?["sugars"]?.ToString() == "high")
        {
            <div class="nutrition-item negative">
                <img src="/img/icon_sugar.svg" class="nutrition-icon" />
                <div class="nutrition-description">
                    <h4>Alto en Azúcares</h4>
                    <p>Puede contribuir al exceso de calorías y afectar la salud dental.</p>
                </div>
                <span>@(productData["nutriments"]?["sugars_100g"] ?? "No disponible") g cada 100 g</span>
                <img src="/img/icon_close.svg" class="close-icon" />
            </div>
        }

        @if (productData["nutrient_levels"]?["saturated-fat"]?.ToString() == "high")
        {
            <div class="nutrition-item negative">
                <img src="/img/icon_fat.svg" class="nutrition-icon" />
                <div class="nutrition-description">
                    <h4>Alto en Grasas Saturadas</h4>
                    <p>Puede contribuir a un aumento de colesterol si se consume en exceso.</p>
                </div>
                <span>@(productData["nutriments"]?["saturated-fat_100g"] ?? "No disponible") g cada 100 g</span>
                <img src="/img/icon_close.svg" class="close-icon" />
            </div>
        }

        @if (productData["nutrient_levels"]?["energy"]?.ToString() == "high")
        {
            <div class="nutrition-item negative">
                <img src="/img/icon_energy.svg" class="nutrition-icon" />
                <div class="nutrition-description">
                    <h4>Alto en Energía</h4>
                    <p>Podría contribuir al exceso de calorías si se consume en exceso.</p>
                </div>
                <span>@(productData["nutriments"]?["energy_100g"] ?? "No disponible") kJ cada 100 g</span>
                <img src="/img/icon_close.svg" class="close-icon" />
            </div>
        }
    </div>
}
else
{
    <div class="no-data-message">
        <p>No se encontró información para el producto buscado: "<strong>@productName</strong>"</p>
    </div>
}
